<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSQRScanner - Grupo AreLuna</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <!-- Tailwind CSS (local) -->
    <link href="/tailwind.css" rel="stylesheet" />
    <!-- jsQR Library (CDN) - poderá ser substituído por versão local posteriormente -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <style>
        /* Light mode background with AreLuna branding */
        body {
            background-image: url('./areluna-light-bg.svg');
            background-size: 400px 300px;
            background-repeat: repeat;
            background-attachment: fixed;
            background-color: #F5F1E8;
        }
        
        /* Dark mode styles */
        .dark {
            color-scheme: dark;
        }
        
        .dark body {
            background-image: url('./areluna-dark-bg.svg');
            background-size: 400px 300px;
            background-repeat: repeat;
            background-attachment: fixed;
            background-color: #1a1a1a;
        }
        
        .dark .bg-white {
            background-color: rgba(31, 41, 55, 0.95) !important;
            color: #f9fafb;
            backdrop-filter: blur(10px);
        }
        
        .dark .bg-gray-50 {
            background-color: rgba(55, 65, 81, 0.9) !important;
            backdrop-filter: blur(5px);
        }
        
        .dark .bg-gray-100 {
            background-color: rgba(75, 85, 99, 0.9) !important;
            backdrop-filter: blur(5px);
        }
        
        /* Light mode card transparency */
        .bg-white {
            background-color: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
        }
        
        .bg-gray-50 {
            background-color: rgba(249, 250, 251, 0.9) !important;
            backdrop-filter: blur(5px);
        }
        
        .bg-gray-100 {
            background-color: rgba(243, 244, 246, 0.9) !important;
            backdrop-filter: blur(5px);
        }
        
        .dark .text-gray-800 {
            color: #f9fafb !important;
        }
        
        .dark .text-gray-700 {
            color: #e5e7eb !important;
        }
        
        .dark .text-gray-600 {
            color: #d1d5db !important;
        }
        
        .dark .border-gray-200 {
            border-color: #4b5563 !important;
        }
        
        .dark .border-gray-300 {
            border-color: #6b7280 !important;
        }
        
        .dark .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2) !important;
        }
        
        .dark .shadow-xl {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2) !important;
        }
        
        /* Gradient backgrounds for dark mode */
        .dark .bg-gradient-to-r.from-blue-50.to-indigo-50 {
            background: linear-gradient(to right, #1e3a8a, #3730a3) !important;
        }
        
        .dark .bg-gradient-to-r.from-green-50.to-emerald-50 {
            background: linear-gradient(to right, #065f46, #047857) !important;
        }
        
        .dark .bg-gradient-to-r.from-blue-50.to-cyan-50 {
            background: linear-gradient(to right, #1e40af, #0891b2) !important;
        }
        
        .dark .bg-gradient-to-r.from-purple-50.to-pink-50 {
            background: linear-gradient(to right, #7c3aed, #db2777) !important;
        }
        
        .dark .bg-gradient-to-r.from-orange-50.to-red-50 {
            background: linear-gradient(to right, #ea580c, #dc2626) !important;
        }
        
        /* Navbar styles */
        .nav-item.active {
            background-color: rgba(59, 130, 246, 0.1);
            color: #2563eb;
        }
        
        .dark .nav-item.active {
            background-color: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen pt-20">
    
    <!-- Top Navigation Bar -->
    <nav class="fixed top-0 left-0 right-0 bg-white dark:bg-gray-800 shadow-lg z-50 border-b border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                
                <!-- Logo -->
                <div class="flex items-center">
                    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg p-2 mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h4"></path>
                        </svg>
                    </div>
                    <div class="hidden sm:block">
                        <h1 class="text-xl font-bold text-gray-800 dark:text-white">AreLuna</h1>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Leitor de Faturas</p>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden lg:flex items-center space-x-1">
                    <a href="#" id="nav-scanner" class="nav-item active flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h4"></path>
                        </svg>
                        Scanner
                    </a>
                    <a href="#" id="nav-automation" class="nav-item flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        Automações
                    </a>
                    <a href="#" id="nav-invoices" class="nav-item flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Faturas
                    </a>
                    <a href="#" id="nav-stats" class="nav-item flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Estatísticas
                    </a>
                    <a href="#" id="nav-settings" class="nav-item flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        Configurações
                    </a>
                </div>

                <!-- Right Side Icons -->
                <div class="flex items-center space-x-2">
                    <!-- Quick Stats Badge -->
                    <div class="hidden md:flex items-center space-x-3 mr-4">
                        <div class="flex items-center bg-blue-50 dark:bg-blue-900/20 px-3 py-1 rounded-full">
                            <svg class="w-4 h-4 text-blue-600 dark:text-blue-400 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h4"></path>
                            </svg>
                            <span class="text-xs font-medium text-blue-700 dark:text-blue-300">
                                <span id="navbar-qr-count">0</span> QRs
                            </span>
                        </div>
                        <div class="flex items-center bg-green-50 dark:bg-green-900/20 px-3 py-1 rounded-full">
                            <svg class="w-4 h-4 text-green-600 dark:text-green-400 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span class="text-xs font-medium text-green-700 dark:text-green-300">
                                <span id="navbar-invoice-count">0</span> Faturas
                            </span>
                        </div>
                    </div>

                    <!-- Dark Mode Toggle -->
                    <button id="darkModeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-5 h-5 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>

                    <!-- Mobile menu button -->
                    <button id="mobileMenuBtn" class="lg:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Navigation Menu -->
        <div id="mobileMenu" class="lg:hidden hidden border-t border-gray-200 dark:border-gray-700">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="#" id="nav-scanner-mobile" class="nav-item active flex items-center px-3 py-2 text-base font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h4"></path>
                    </svg>
                    Scanner QR
                </a>
                <a href="#" id="nav-automation-mobile" class="nav-item flex items-center px-3 py-2 text-base font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Automações
                </a>
                <a href="#" id="nav-invoices-mobile" class="nav-item flex items-center px-3 py-2 text-base font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    Faturas
                </a>
                <a href="#" id="nav-stats-mobile" class="nav-item flex items-center px-3 py-2 text-base font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    Estatísticas
                </a>
                <a href="#" id="nav-settings-mobile" class="nav-item flex items-center px-3 py-2 text-base font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Configurações
                </a>
                
                <!-- Mobile Stats -->
                <div class="px-3 pt-4 pb-2 border-t border-gray-200 dark:border-gray-700 mt-2">
                    <div class="flex justify-around">
                        <div class="text-center">
                            <p class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="mobile-qr-count">0</p>
                            <p class="text-xs text-gray-600 dark:text-gray-400">QRs Lidos</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-green-600 dark:text-green-400" id="mobile-invoice-count">0</p>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Faturas</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="transition-all duration-300 relative z-10 min-h-screen pb-20">
        <div class="container mx-auto px-4 py-8 pt-16 lg:pt-8 pb-20">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="flex items-center justify-center mb-4">
                <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-full p-3 mr-4">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                    </svg>
                </div>
                <div class="flex-1">
                    <h1 class="text-4xl font-bold text-gray-800 mb-1">Leitor de Faturas</h1>
                    <p class="text-lg text-blue-600 font-medium">Grupo AreLuna</p>
                </div>
                <!-- Header Controls -->
                <div class="flex items-center space-x-2 ml-4">
                    <!-- Help/Tutorial Button -->
                    <button id="helpButton" class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors duration-200 dark:bg-gray-700 dark:hover:bg-gray-600 group" title="Tutorial e Ajuda">
                        <svg class="w-6 h-6 text-gray-600 dark:text-gray-300 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </button>
                    
                    <!-- Dark Mode Toggle -->
                    <button id="darkModeToggle" class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors duration-200 dark:bg-gray-700 dark:hover:bg-gray-600" title="Alternar Modo Escuro">
                        <svg id="darkModeIcon" class="w-6 h-6 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <p class="text-gray-600 max-w-2xl mx-auto">Scanner inteligente de QR codes de faturas portuguesas com processamento automático e integração contabilística</p>
        </div>

        <!-- Instructions Panel -->
        <div class="max-w-4xl mx-auto mb-6">
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 rounded-lg p-6">
                <div class="flex items-start">
                    <div class="bg-blue-500 text-white rounded-full p-2 mr-4 flex-shrink-0">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">📋 Como usar o scanner</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="flex items-start space-x-3">
                                <div class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0">1</div>
                                <div>
                                    <p class="font-medium text-gray-800">📱 Usar Câmera</p>
                                    <p class="text-sm text-gray-600">Clique em "Iniciar Câmera" e aponte para o QR code da fatura</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <div class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0">2</div>
                                <div>
                                    <p class="font-medium text-gray-800">🖼️ Carregar Imagem</p>
                                    <p class="text-sm text-gray-600">Ou faça upload de uma foto/screenshot do QR code</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-white rounded-lg border border-blue-200">
                            <p class="text-sm text-blue-700">
                                <span class="font-medium">💡 Dica:</span> 
                                Certifique-se que o QR code está bem iluminado e focado para melhor leitura
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content - Unified Dashboard -->
        <div class="max-w-7xl mx-auto">
            <!-- Dashboard Grid -->
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8">
                <!-- Quick Actions Panel -->
                <div class="xl:col-span-1">
                    <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            Ações Rápidas
                        </h3>
                        <div class="space-y-3">
                            <button class="w-full flex items-center gap-3 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg hover:from-blue-100 hover:to-indigo-100 transition-all duration-200 border border-blue-200">
                                <div class="bg-blue-500 text-white rounded-lg p-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h4"></path>
                                    </svg>
                                </div>
                                <div class="text-left">
                                    <p class="font-medium text-gray-800">Scan QR Code</p>
                                    <p class="text-sm text-gray-600">Iniciar scanner</p>
                                </div>
                            </button>
                            <button class="w-full flex items-center gap-3 p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg hover:from-green-100 hover:to-emerald-100 transition-all duration-200 border border-green-200">
                                <div class="bg-green-500 text-white rounded-lg p-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                </div>
                                <div class="text-left">
                                    <p class="font-medium text-gray-800">Nova Fatura</p>
                                    <p class="text-sm text-gray-600">Processar fatura</p>
                                </div>
                            </button>
                            <button class="w-full flex items-center gap-3 p-3 bg-gradient-to-r from-orange-50 to-red-50 rounded-lg hover:from-orange-100 hover:to-red-100 transition-all duration-200 border border-orange-200">
                                <div class="bg-orange-500 text-white rounded-lg p-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                </div>
                                <div class="text-left">
                                    <p class="font-medium text-gray-800">Automação</p>
                                    <p class="text-sm text-gray-600">Configurar regras</p>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Statistics Overview -->
                <div class="xl:col-span-2">
                    <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            Estatísticas do Sistema
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">QRs Lidos</p>
                                        <p id="dashboard-qr-count" class="text-2xl font-bold text-blue-600">0</p>
                                    </div>
                                    <div class="bg-blue-500 text-white rounded-lg p-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h4"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border border-green-200">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">Faturas</p>
                                        <p id="dashboard-invoice-count" class="text-2xl font-bold text-green-600">0</p>
                                    </div>
                                    <div class="bg-green-500 text-white rounded-lg p-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-lg border border-purple-200">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">Automações</p>
                                        <p id="dashboard-automation-count" class="text-2xl font-bold text-purple-600">0</p>
                                    </div>
                                    <div class="bg-purple-500 text-white rounded-lg p-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-orange-50 to-red-50 p-4 rounded-lg border border-orange-200">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">Processadas</p>
                                        <p id="dashboard-processed-count" class="text-2xl font-bold text-orange-600">0</p>
                                    </div>
                                    <div class="bg-orange-500 text-white rounded-lg p-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Tools Sections -->
            <div class="space-y-6">
                <!-- Scanner Section -->
                <div id="scanner-section" class="section-content">
                    <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                Scanner de QR Codes
                            </h3>
                            <button class="text-gray-400 hover:text-gray-600 transition-colors" onclick="toggleSection('scanner-content')">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <div id="scanner-content" class="space-y-4">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <button id="startCamera" class="flex items-center justify-center gap-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                            Iniciar Câmera
                        </button>
                        
                        <button id="stopCamera" class="flex items-center justify-center gap-2 bg-gradient-to-r from-red-500 to-rose-600 text-white px-6 py-3 rounded-xl font-medium hover:from-red-600 hover:to-rose-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5" disabled>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"></path>
                            </svg>
                            Parar Câmera
                        </button>
                    </div>
                    
                    <!-- Camera Selection -->
                    <div class="mb-4">
                        <label for="cameraSelect" class="block text-sm font-medium text-gray-700 mb-2">Selecionar Câmera</label>
                        <select id="cameraSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Selecionar Câmera</option>
                        </select>
                    </div>
                    
                    <!-- Camera Preview -->
                    <div class="relative bg-gray-100 rounded-xl overflow-hidden mb-4" style="aspect-ratio: 16/9;">
                        <video id="preview" class="w-full h-full object-cover" style="display: none;"></video>
                        <canvas id="qr-canvas" class="w-full h-full object-cover" style="display: none;"></canvas>
                        <div id="camera-placeholder" class="flex items-center justify-center h-full text-gray-500">
                            <div class="text-center">
                                <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <p class="text-lg font-medium">Câmera Desligada</p>
                                <p class="text-sm">Clique em "Iniciar Câmera" para começar</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- File Upload for Scanner Section -->
                    <div class="mt-4 p-4 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300">
                        <label for="fileInputScanner" class="flex flex-col items-center justify-center cursor-pointer">
                            <svg class="w-8 h-8 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <span class="text-sm font-medium text-gray-600">Carregar Imagem com QR Code</span>
                            <span class="text-xs text-gray-500 mt-1">PNG, JPG, JPEG até 10MB</span>
                        </label>
                        <input type="file" id="fileInputScanner" accept="image/*" class="hidden">
                    </div>
                    

                </div>
            </div>

                        </div>
                    </div>
                </div>

                <!-- Invoices Section -->
                <div id="invoices-section" class="section-content">
                    <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                Gestão de Faturas
                            </h3>
                            <button class="text-gray-400 hover:text-gray-600 transition-colors" onclick="toggleSection('invoices-content')">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <div id="invoices-content" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-xl border border-blue-200">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm text-blue-600 font-medium">Processadas Hoje</p>
                                            <p class="text-2xl font-bold text-blue-700" id="invoicesProcessedToday">0</p>
                                        </div>
                                        <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-4 rounded-xl border border-yellow-200">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm text-yellow-600 font-medium">Pendentes</p>
                                            <p class="text-2xl font-bold text-yellow-700" id="invoicesPending">0</p>
                                        </div>
                                        <svg class="w-8 h-8 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-r from-red-50 to-rose-50 p-4 rounded-xl border border-red-200">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm text-red-600 font-medium">Com Erros</p>
                                            <p class="text-2xl font-bold text-red-700" id="invoicesWithErrors">0</p>
                                        </div>
                                        <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Recent Invoices Table -->
                            <div class="bg-gray-50 rounded-xl p-4 mb-6">
                                <h4 class="text-lg font-medium text-gray-800 mb-3">Faturas Recentes</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead>
                                            <tr class="border-b border-gray-200">
                                                <th class="text-left py-2 px-3 font-medium text-gray-600">Data</th>
                                                <th class="text-left py-2 px-3 font-medium text-gray-600">Fornecedor</th>
                                                <th class="text-left py-2 px-3 font-medium text-gray-600">NIF</th>
                                                <th class="text-left py-2 px-3 font-medium text-gray-600">Valor</th>
                                                <th class="text-left py-2 px-3 font-medium text-gray-600">IVA</th>
                                                <th class="text-left py-2 px-3 font-medium text-gray-600">Status</th>
                                                <th class="text-left py-2 px-3 font-medium text-gray-600">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="invoicesTableBody">
                                            <tr>
                                                <td colspan="7" class="text-center py-8 text-gray-500">
                                                    <svg class="w-12 h-12 mx-auto mb-2 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                                    </svg>
                                                    Nenhuma fatura processada ainda
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Invoice Processing Controls -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Accounting Integration -->
                                <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200">
                                    <h5 class="text-lg font-semibold text-green-800 mb-4 flex items-center gap-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                        </svg>
                                        Integração Contabilística
                                    </h5>
                                    
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-green-700 mb-2">Categoria Contabilística</label>
                                            <select id="categoriaContabil" class="w-full px-3 py-2 border border-green-300 rounded-md text-sm bg-white">
                                                <option value="">Selecionar categoria...</option>
                                                <option value="62-FSE">62 - Fornecimentos e Serviços Externos</option>
                                                <option value="61-CMVMC">61 - Custo das Mercadorias Vendidas</option>
                                                <option value="68-PROV">68 - Provisões do Exercício</option>
                                                <option value="64-GASTOS">64 - Gastos com Pessoal</option>
                                                <option value="63-IMP">63 - Impostos</option>
                                                <option value="69-OUTROS">69 - Outros Gastos</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-green-700 mb-2">Centro de Custo</label>
                                            <select id="centroCusto" class="w-full px-3 py-2 border border-green-300 rounded-md text-sm bg-white">
                                                <option value="">Selecionar centro...</option>
                                                <option value="CC001">CC001 - Administração</option>
                                                <option value="CC002">CC002 - Operações</option>
                                                <option value="CC003">CC003 - Marketing</option>
                                                <option value="CC004">CC004 - TI</option>
                                                <option value="CC005">CC005 - Recursos Humanos</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-green-700 mb-2">Regime de IVA</label>
                                            <select id="regimeIVA" class="w-full px-3 py-2 border border-green-300 rounded-md text-sm bg-white">
                                                <option value="normal">Normal - 100% dedutível</option>
                                                <option value="pro-rata">Pro-rata - 80% dedutível</option>
                                                <option value="isento">Isento de IVA</option>
                                                <option value="nao-dedutivel">Não dedutível</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- Banking Integration -->
                                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-6 rounded-xl border border-blue-200">
                                    <h5 class="text-lg font-semibold text-blue-800 mb-4 flex items-center gap-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                                        </svg>
                                        Integração Bancária
                                    </h5>
                                    
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-blue-700 mb-2">Banco</label>
                                            <select id="bancoSelecionado" class="w-full px-3 py-2 border border-blue-300 rounded-md text-sm bg-white">
                                                <option value="">Selecionar banco...</option>
                                                <option value="CGD">Caixa Geral de Depósitos</option>
                                                <option value="BCP">Millennium BCP</option>
                                                <option value="BES">Novo Banco</option>
                                                <option value="SANTANDER">Santander Totta</option>
                                                <option value="BPI">Banco BPI</option>
                                                <option value="ABANCA">ABANCA</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-blue-700 mb-2">Conta Bancária</label>
                                            <select id="contaSelecionada" class="w-full px-3 py-2 border border-blue-300 rounded-md text-sm bg-white">
                                                <option value="">Selecionar conta...</option>
                                                <option value="PT50000000000000000001">Conta Corrente Principal</option>
                                                <option value="PT50000000000000000002">Conta Poupança</option>
                                                <option value="PT50000000000000000003">Conta Operacional</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-blue-700 mb-2">Data de Vencimento</label>
                                            <input type="date" id="dataVencimento" class="w-full px-3 py-2 border border-blue-300 rounded-md text-sm bg-white">
                                        </div>
                                        
                                        <div class="flex items-center space-x-2">
                                            <input type="checkbox" id="integracaoBancaria" class="rounded border-blue-300 text-blue-600 focus:ring-blue-500">
                                            <label for="integracaoBancaria" class="text-sm text-blue-700">Efetuar pagamento automático</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Export and Compliance -->
                            <div class="mt-6 bg-gradient-to-r from-purple-50 to-indigo-50 p-6 rounded-xl border border-purple-200">
                                <h5 class="text-lg font-semibold text-purple-800 mb-4 flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    Exportação e Conformidade
                                </h5>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <button class="flex items-center justify-center px-4 py-3 bg-white border border-purple-300 rounded-lg hover:bg-purple-50 transition-colors">
                                        <svg class="w-5 h-5 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-purple-700">Exportar SAF-T</span>
                                    </button>
                                    
                                    <button class="flex items-center justify-center px-4 py-3 bg-white border border-purple-300 rounded-lg hover:bg-purple-50 transition-colors">
                                        <svg class="w-5 h-5 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2a4 4 0 118 0v2M9 17a2 2 0 002 2h2a2 2 0 002-2M9 17h6"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-purple-700">Validar AT</span>
                                    </button>
                                    
                                    <button class="flex items-center justify-center px-4 py-3 bg-white border border-purple-300 rounded-lg hover:bg-purple-50 transition-colors">
                                        <svg class="w-5 h-5 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-purple-700">Backup Excel</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Automations Section -->
                <div id="automation-section" class="section-content">
                    <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                                <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                                Automações do Sistema
                            </h3>
                            <button class="text-gray-400 hover:text-gray-600 transition-colors" onclick="toggleSection('automation-content')">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <div id="automation-content" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <!-- Auto-scan QR -->
                                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200">
                                    <div class="flex items-center gap-2">
                                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-gray-700">Auto-scan</span>
                                    </div>
                                    <div class="relative">
                                        <input type="checkbox" id="autoScanToggle" class="sr-only" checked>
                                        <div class="w-10 h-6 bg-green-500 rounded-full shadow-inner relative cursor-pointer transition-colors duration-200">
                                            <div class="w-4 h-4 bg-white rounded-full shadow absolute top-1 right-1 transition-transform duration-200"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Auto-fill Form -->
                                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl border border-blue-200">
                                    <div class="flex items-center gap-2">
                                        <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-gray-700">Auto-fill</span>
                                    </div>
                                    <div class="relative">
                                        <input type="checkbox" id="autoFillToggle" class="sr-only" checked>
                                        <div class="w-10 h-6 bg-blue-500 rounded-full shadow-inner relative cursor-pointer transition-colors duration-200">
                                            <div class="w-4 h-4 bg-white rounded-full shadow absolute top-1 right-1 transition-transform duration-200"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Auto-save -->
                                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-violet-50 rounded-xl border border-purple-200">
                                    <div class="flex items-center gap-2">
                                        <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-gray-700">Auto-save</span>
                                    </div>
                                    <div class="relative">
                                        <input type="checkbox" id="autoSaveToggle" class="sr-only" checked>
                                        <div class="w-10 h-6 bg-purple-500 rounded-full shadow-inner relative cursor-pointer transition-colors duration-200">
                                            <div class="w-4 h-4 bg-white rounded-full shadow absolute top-1 right-1 transition-transform duration-200"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Notifications -->
                                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl border border-orange-200">
                                    <div class="flex items-center gap-2">
                                        <svg class="w-4 h-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM4 19h6v-2H4v2zM4 15h8v-2H4v2zM4 11h8V9H4v2z"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-gray-700">Alertas</span>
                                    </div>
                                    <div class="relative">
                                        <input type="checkbox" id="notificationsToggle" class="sr-only" checked>
                                        <div class="w-10 h-6 bg-orange-500 rounded-full shadow-inner relative cursor-pointer transition-colors duration-200">
                                            <div class="w-4 h-4 bg-white rounded-full shadow absolute top-1 right-1 transition-transform duration-200"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Stats -->
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <div class="flex items-center justify-between text-sm">
                                    <div class="flex items-center gap-4">
                                        <span class="text-gray-600">
                                            <span class="font-medium text-green-600" id="qrProcessedCount">0</span> QRs processados hoje
                                        </span>
                                        <span class="text-gray-600">
                                            <span class="font-medium text-blue-600" id="lastProcessedTime">--:--</span> último processamento
                                        </span>
                                    </div>
                                    <button id="resetStats" class="text-gray-500 hover:text-gray-700 transition-colors">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings-section" class="section-content">
                    <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                Configurações do Sistema
                            </h3>
                            <button class="text-gray-400 hover:text-gray-600 transition-colors" onclick="toggleSection('settings-content')">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <div id="settings-content" class="space-y-6">
                            <!-- General Settings -->
                            <div class="bg-gray-50 rounded-xl p-4">
                                <h4 class="text-lg font-medium text-gray-800 mb-4">Configurações Gerais</h4>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-gray-700">Modo Escuro</p>
                                            <p class="text-sm text-gray-500">Alternar entre tema claro e escuro</p>
                                        </div>
                                        <button id="darkModeSettingsToggle" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                            <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span>
                                        </button>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-gray-700">Notificações</p>
                                            <p class="text-sm text-gray-500">Receber alertas do sistema</p>
                                        </div>
                                        <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                            <span class="inline-block h-4 w-4 transform translate-x-6 rounded-full bg-white transition-transform"></span>
                                        </button>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-gray-700">Som</p>
                                            <p class="text-sm text-gray-500">Reproduzir sons de feedback</p>
                                        </div>
                                        <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                            <span class="inline-block h-4 w-4 transform translate-x-6 rounded-full bg-white transition-transform"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Data Management -->
                            <div class="bg-gray-50 rounded-xl p-4">
                                <h4 class="text-lg font-medium text-gray-800 mb-4">Gestão de Dados</h4>
                                <div class="space-y-3">
                                    <button class="w-full flex items-center justify-between p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors border border-gray-200">
                                        <div class="flex items-center gap-3">
                                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                            <div class="text-left">
                                                <p class="font-medium text-gray-700">Exportar Dados</p>
                                                <p class="text-sm text-gray-500">Baixar todas as faturas processadas</p>
                                            </div>
                                        </div>
                                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                    
                                    <button class="w-full flex items-center justify-between p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors border border-gray-200">
                                        <div class="flex items-center gap-3">
                                            <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                            </svg>
                                            <div class="text-left">
                                                <p class="font-medium text-gray-700">Backup</p>
                                                <p class="text-sm text-gray-500">Criar backup dos dados</p>
                                            </div>
                                        </div>
                                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                    
                                    <button class="w-full flex items-center justify-between p-3 bg-white rounded-lg hover:bg-red-50 transition-colors border border-red-200 text-red-600">
                                        <div class="flex items-center gap-3">
                                            <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                            <div class="text-left">
                                                <p class="font-medium text-red-700">Limpar Dados</p>
                                                <p class="text-sm text-red-500">Remover todos os dados armazenados</p>
                                            </div>
                                        </div>
                                        <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-6 border border-gray-100">
                <div class="flex flex-wrap gap-4 items-center justify-center mb-6">
                    <!-- Camera controls removed from here - they are now in the scanner section -->
                    </select>
                </div>

                <!-- Camera Feed -->
                <div class="relative bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl overflow-hidden border-2 border-dashed border-gray-300" style="height: 400px;">
                    <video id="video" class="w-full h-full object-cover" autoplay muted playsinline style="display: none;"></video>
                    <canvas id="canvas" class="absolute top-0 left-0 w-full h-full" style="display: none;"></canvas>
                    <div id="cameraPlaceholder" class="flex items-center justify-center h-full text-gray-500">
                        <div class="text-center">
                            <div class="mb-4">
                                <svg class="w-16 h-16 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </div>
                            <p id="scanStatus" class="text-lg font-medium text-gray-600">Clique em "Iniciar Câmera" para começar</p>
                            <p class="text-sm text-gray-500 mt-2">Posicione o QR code da fatura no centro da tela</p>
                        </div>
                    </div>
                </div>

                <!-- File Upload -->
                <div class="mt-6">
                    <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-3">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        Ou carregue uma imagem
                    </label>
                    <input type="file" id="fileInput2" accept="image/*" class="block w-full text-sm text-gray-600 file:mr-4 file:py-3 file:px-6 file:rounded-xl file:border-0 file:text-sm file:font-medium file:bg-gradient-to-r file:from-blue-50 file:to-blue-100 file:text-blue-700 hover:file:from-blue-100 hover:file:to-blue-200 file:transition-all file:shadow-sm border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>

            <!-- Processing Progress Bar -->
            <div id="processingProgress" class="bg-white border border-gray-200 rounded-2xl shadow-lg p-6 mb-6" style="display: none;">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                        <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div>
                        Processando QR Code
                    </h3>
                    <span id="progressPercentage" class="text-sm font-medium text-blue-600">0%</span>
                </div>
                
                <!-- Progress Bar -->
                <div class="w-full bg-gray-200 rounded-full h-3 mb-4 overflow-hidden">
                    <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
                </div>
                
                <!-- Progress Steps -->
                <div class="space-y-2">
                    <div id="step1" class="flex items-center gap-2 text-sm text-gray-600">
                        <div class="w-4 h-4 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <div class="w-2 h-2 rounded-full bg-gray-300"></div>
                        </div>
                        <span>Lendo QR Code...</span>
                    </div>
                    <div id="step2" class="flex items-center gap-2 text-sm text-gray-600">
                        <div class="w-4 h-4 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <div class="w-2 h-2 rounded-full bg-gray-300"></div>
                        </div>
                        <span>Decodificando dados...</span>
                    </div>
                    <div id="step3" class="flex items-center gap-2 text-sm text-gray-600">
                        <div class="w-4 h-4 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <div class="w-2 h-2 rounded-full bg-gray-300"></div>
                        </div>
                        <span>Validando informações...</span>
                    </div>
                    <div id="step4" class="flex items-center gap-2 text-sm text-gray-600">
                        <div class="w-4 h-4 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <div class="w-2 h-2 rounded-full bg-gray-300"></div>
                        </div>
                        <span>Preparando resumo...</span>
                    </div>
                </div>
            </div>

            <!-- Invoice Summary Card -->
            <div id="invoiceSummary" class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-2xl shadow-lg p-6 mb-6 transform transition-all duration-500 ease-out opacity-0 scale-95" style="display: none;">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Resumo da Fatura
                    </h3>
                    <div class="flex items-center gap-2 text-green-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-sm font-medium">QR Processado</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <!-- NIF Emitente -->
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                        <div class="flex items-center gap-2 mb-2">
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                            <span class="text-xs font-medium text-gray-500 uppercase tracking-wide">NIF Emitente</span>
                        </div>
                        <p id="summaryNifEmitente" class="text-lg font-bold text-gray-800">-</p>
                    </div>
                    
                    <!-- Data da Fatura -->
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                        <div class="flex items-center gap-2 mb-2">
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <span class="text-xs font-medium text-gray-500 uppercase tracking-wide">Data</span>
                        </div>
                        <p id="summaryDataFatura" class="text-lg font-bold text-gray-800">-</p>
                    </div>
                    
                    <!-- Valor Total -->
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                        <div class="flex items-center gap-2 mb-2">
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                            <span class="text-xs font-medium text-gray-500 uppercase tracking-wide">Valor Total</span>
                        </div>
                        <p id="summaryTotal" class="text-2xl font-bold text-blue-600">-</p>
                    </div>
                </div>
                
                <!-- Additional Info Row -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                        <div class="flex items-center gap-2 mb-2">
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span class="text-xs font-medium text-gray-500 uppercase tracking-wide">Tipo de Documento</span>
                        </div>
                        <p id="summaryTipoDocumento" class="text-lg font-semibold text-gray-800">-</p>
                    </div>
                    
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                        <div class="flex items-center gap-2 mb-2">
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                            <span class="text-xs font-medium text-gray-500 uppercase tracking-wide">NIF Adquirente</span>
                        </div>
                        <p id="summaryNifAdquirente" class="text-lg font-semibold text-gray-800">-</p>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-3 pt-4 border-t border-gray-200">
                    <button id="proceedToForm" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 shadow-md hover:shadow-lg flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        Preencher Formulário
                    </button>
                    <button id="scanAnother" class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 shadow-md hover:shadow-lg flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        Ler Outro QR
                    </button>
                </div>
            </div>

            <!-- Results -->
            <div id="results" class="bg-white rounded-2xl shadow-lg p-6 mb-6" style="display: none;">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Resultado</h3>
                <div id="successResult" class="hidden">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h4 class="text-green-800 font-medium mb-2">✅ QR Code Decodificado</h4>
                        <div class="bg-white rounded border p-3 mb-3">
                            <code id="qrContent" class="text-sm text-gray-800 break-all"></code>
                        </div>
                        <div class="flex gap-2">
                            <button id="copyBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm">Copiar</button>
                            <button id="downloadBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm">Download</button>
                        </div>
                    </div>
                </div>
                <div id="errorResult" class="hidden">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h4 class="text-red-800 font-medium mb-2">❌ Erro na Decodificação</h4>
                        <p id="errorMessage" class="text-red-700 text-sm"></p>
                    </div>
                </div>
            </div>

            <!-- Invoice Processing Interface -->
            <div id="invoiceProcessing" class="bg-white rounded-2xl shadow-lg p-6 mb-6" style="display: none;">
                <!-- Visual Prompt Header -->
                <div class="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4 mb-6">
                    <div class="flex items-center mb-3">
                        <div class="bg-green-500 text-white rounded-full p-2 mr-3">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-800">Fatura decodificada com sucesso!</h3>
                    </div>
                    <p class="text-gray-700 mb-4">
                        Pretende lançar esta fatura no sistema e acionar integrações automáticas? 
                        Selecione as ações desejadas abaixo ou preencha campos adicionais conforme necessário:
                    </p>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                        <div class="flex items-center text-gray-600">
                            <span class="mr-2">💳</span> Efetuar pagamento via banco
                        </div>
                        <div class="flex items-center text-gray-600">
                            <span class="mr-2">📊</span> Registrar IVA recolhido
                        </div>
                        <div class="flex items-center text-gray-600">
                            <span class="mr-2">🏷️</span> Categorizar fatura
                        </div>
                        <div class="flex items-center text-gray-600">
                            <span class="mr-2">📝</span> Lançar em contas a pagar
                        </div>
                        <div class="flex items-center text-gray-600">
                            <span class="mr-2">📎</span> Anexar comprovativo
                        </div>
                        <div class="flex items-center text-gray-600">
                            <span class="mr-2">🔔</span> Criar alerta de vencimento
                        </div>
                    </div>
                </div>

                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">🧾 Dados da Fatura</h3>
                    <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                        Fatura decodificada!
                    </div>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <p class="text-blue-800 font-medium mb-2">
                        🎯 Pretende lançar esta fatura no sistema e acionar integrações automáticas?
                    </p>
                    <p class="text-blue-700 text-sm">
                        Selecione as ações desejadas abaixo ou preencha campos adicionais conforme necessário:
                    </p>
                </div>

                <!-- Invoice Details Form -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Left Column - Invoice Data -->
                    <div class="space-y-4">
                        <h4 class="font-semibold text-gray-800 border-b pb-2">📋 Dados da Fatura</h4>
                        
                        <!-- Seção A-E: Identificação -->
                        <div class="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                            <button class="accordion-header w-full px-4 py-3 text-left font-medium text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center justify-between" data-target="identificacao-section">
                                <div class="flex items-center">
                                    <span class="mr-2">🏢</span> Identificação das Partes
                                </div>
                                <svg class="accordion-icon w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="identificacao-section" class="accordion-content p-4 border-t border-gray-200" style="display: block;">
                            <div class="grid grid-cols-3 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">A - NIF do Emitente</label>
                                    <input type="text" id="nifEmitente" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                    <div class="text-xs text-gray-500 mt-1">Pessoa singular ou empresa que emitiu a fatura</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">B - NIF do Adquirente</label>
                                    <input type="text" id="nifAdquirente" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                    <div class="text-xs text-gray-500 mt-1">Instituto AreLuna (cliente)</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Adquirente</label>
                                    <input type="text" id="nomeAdquirente" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm bg-green-50" readonly>
                                    <div class="text-xs text-green-600 mt-1">✓ Preenchido automaticamente para empresas do Grupo AreLuna</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-3 gap-3 mt-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">C - País do Emitente</label>
                                    <input type="text" id="paisEmitente" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">D - País do Adquirente</label>
                                    <input type="text" id="paisAdquirente" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                    <div class="text-xs text-red-500 mt-1" id="paisAdquirenteWarning" style="display: none;">⚠️ Não é um país ISO válido</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">E - Tipo de Adquirente</label>
                                    <input type="text" id="tipoAdquirente" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                    <div class="text-xs text-gray-500 mt-1">N = Não residente</div>
                                </div>
                            </div>
                        </div>

                        <!-- Seção F-H: Documento -->
                        <div class="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                            <button class="accordion-header w-full px-4 py-3 text-left font-medium text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center justify-between" data-target="documento-section">
                                <div class="flex items-center">
                                    <span class="mr-2">📄</span> Dados do Documento
                                </div>
                                <svg class="accordion-icon w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="documento-section" class="accordion-content p-4 border-t border-gray-200" style="display: none;">
                            <div class="grid grid-cols-3 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">F - Data do Documento</label>
                                    <input type="date" id="dataFatura" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">G - Série e Número</label>
                                    <input type="text" id="numeroDocumento" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                    <div class="text-xs text-gray-500 mt-1">Identificador único da fatura</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">H - Código do Documento</label>
                                    <input type="text" id="codigoDocumento" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                    <div class="text-xs text-gray-500 mt-1">Valor genérico ou omitido</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 mt-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Documento</label>
                                    <input type="text" id="tipoDocumento" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm font-medium" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">I1 - Moeda</label>
                                    <input type="text" id="moeda" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                    <div class="text-xs text-red-500 mt-1" id="moedaWarning" style="display: none;">⚠️ Erro - o correto seria EUR</div>
                                </div>
                            </div>
                        </div>

                        <!-- Seção I2-I8: Valores Base -->
                        <div class="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                            <button class="accordion-header w-full px-4 py-3 text-left font-medium text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center justify-between" data-target="valores-section">
                                <div class="flex items-center">
                                    <span class="mr-2">💰</span> Valores e IVA
                                </div>
                                <svg class="accordion-icon w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="valores-section" class="accordion-content p-4 border-t border-gray-200" style="display: none;">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">I2-I6 - Valores de IVA por Taxas</label>
                                    <input type="text" id="valoresIVATaxas" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                    <div class="text-xs text-gray-500 mt-1">Nenhum valor declarado nas taxas habituais</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">I7 - Valor Base Isento ou Sujeito</label>
                                    <input type="text" id="baseTributavel" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                    <div class="text-xs text-gray-500 mt-1">Valor da base tributável</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 mt-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">I8 - Valor do IVA Calculado</label>
                                    <input type="text" id="iva" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                    <div class="text-xs text-gray-500 mt-1">IVA sobre a base</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">N - Total de IVA</label>
                                    <input type="text" id="totalIVA" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                    <div class="text-xs text-gray-500 mt-1">Confirma o valor anterior</div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">O - Total com IVA</label>
                                <input type="text" id="total" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm font-semibold bg-green-50" readonly>
                                <div class="text-xs text-gray-500 mt-1">Soma: 12.20 + 2.80</div>
                            </div>
                        </div>

                        <!-- Seção N1-N6: Códigos de Isenção -->
                        <div class="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                            <button class="accordion-header w-full px-4 py-3 text-left font-medium text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center justify-between" data-target="isencao-section">
                                <div class="flex items-center">
                                    <span class="mr-2">📋</span> Códigos de Isenção e Motivos
                                </div>
                                <svg class="accordion-icon w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="isencao-section" class="accordion-content p-4 border-t border-gray-200" style="display: none;">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Q - Código de Isenção</label>
                                    <input type="text" id="codigoIsencao" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                    <div class="text-xs text-red-500 mt-1" id="codigoIsencaoWarning" style="display: none;">⚠️ Parece incorreto - códigos válidos são padronizados</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">R - Motivo de Isenção (código AT)</label>
                                    <input type="text" id="motivoIsencao" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" readonly>
                                    <div class="text-xs text-gray-500 mt-1">M88 = Isento - outras situações não previstas</div>
                                </div>
                            </div>
                        </div>

                        <!-- Campos Adicionais -->
                        <div class="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                            <button class="accordion-header w-full px-4 py-3 text-left font-medium text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center justify-between" data-target="adicionais-section">
                                <div class="flex items-center">
                                    <span class="mr-2">📝</span> Campos Adicionais
                                </div>
                                <svg class="accordion-icon w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="adicionais-section" class="accordion-content p-4 border-t border-gray-200" style="display: none;">
                            <div class="space-y-3">
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Descrição/Observações</label>
                                <textarea id="descricao" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" rows="2" placeholder="Adicione uma descrição ou observações sobre esta fatura..."></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Referência Interna</label>
                                <input type="text" id="referenciaInterna" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" placeholder="Ex: PO-2024-001, Projeto X, etc.">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Centro de Custo</label>
                                <select id="centroCusto" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                    <option value="">Selecionar centro de custo...</option>
                                    <option value="administrativo">Administrativo</option>
                                    <option value="comercial">Comercial</option>
                                    <option value="producao">Produção</option>
                                    <option value="marketing">Marketing</option>
                                    <option value="ti">Tecnologia da Informação</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Actions -->
                    <div class="space-y-4">
                        <h4 class="font-semibold text-gray-800 border-b pb-2">⚡ Ações Automáticas</h4>
                        
                        <!-- Banking Integration -->
                        <div class="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                            <button class="accordion-header w-full px-4 py-3 text-left font-medium text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center justify-between" data-target="banking-section">
                                <div class="flex items-center">
                                    <span class="mr-2">🏦</span> Opções Bancárias
                                </div>
                                <svg class="accordion-icon w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="banking-section" class="accordion-content p-4 border-t border-gray-200" style="display: none;">
                            <div class="flex items-center mb-3">
                                <input type="checkbox" id="efetuarPagamento" class="mr-2">
                                <label for="efetuarPagamento" class="font-medium text-gray-800">Efetuar pagamento via banco</label>
                            </div>
                            <div id="bankingOptions" class="ml-6 space-y-2" style="display: none;">
                                <select id="bancoSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                    <option value="">Selecionar instituição bancária...</option>
                                    <option value="caixa">Caixa Geral de Depósitos</option>
                                    <option value="bcp">Millennium BCP</option>
                                    <option value="santander">Santander</option>
                                    <option value="bes">Novo Banco</option>
                                    <option value="bpi">Banco BPI</option>
                                    <option value="montepio">Montepio</option>
                                </select>
                                <input type="text" id="contaBancaria" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" placeholder="Número da conta (opcional)">
                                <div class="bg-blue-50 border border-blue-200 rounded p-3 text-sm">
                                    <p class="font-medium text-blue-800 mb-2">💡 Detalhes pré-preenchidos:</p>
                                    <div class="space-y-1 text-blue-700">
                                        <div>Beneficiário: <span id="beneficiarioPreenchido" class="font-medium">-</span></div>
                                        <div>IBAN: <span id="ibanPreenchido" class="font-medium">-</span></div>
                                        <div>Valor: <span id="valorPreenchido" class="font-medium">-</span></div>
                                        <div>Referência: <span id="referenciaPreenchida" class="font-medium">-</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- VAT Control -->
                        <div class="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                            <button class="accordion-header w-full px-4 py-3 text-left font-medium text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center justify-between" data-target="vat-section">
                                <div class="flex items-center">
                                    <span class="mr-2">📊</span> Controle de IVA
                                </div>
                                <svg class="accordion-icon w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="vat-section" class="accordion-content p-4 border-t border-gray-200" style="display: none;">
                            <div class="flex items-center mb-3">
                                <input type="checkbox" id="registrarIVA" class="mr-2">
                                <label for="registrarIVA" class="font-medium text-gray-800">Registrar IVA recolhido pela adquirente</label>
                            </div>
                            <div id="ivaOptions" class="ml-6 space-y-2" style="display: none;">
                                <select id="regimeIVA" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                    <option value="">Selecionar regime de IVA...</option>
                                    <option value="normal">Regime Normal</option>
                                    <option value="simplificado">Regime Simplificado</option>
                                    <option value="isento">Isento de IVA</option>
                                    <option value="rc">Reverse Charge</option>
                                </select>
                                <div class="text-xs text-gray-600">
                                    IVA será registrado automaticamente conforme o regime selecionado
                                </div>
                            </div>
                        </div>

                        <!-- Accounting Categories -->
                        <div class="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                            <button class="accordion-header w-full px-4 py-3 text-left font-medium text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center justify-between" data-target="accounting-section">
                                <div class="flex items-center">
                                    <span class="mr-2">🏷️</span> Categorias Contábeis
                                </div>
                                <svg class="accordion-icon w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="accounting-section" class="accordion-content p-4 border-t border-gray-200" style="display: none;">
                            <div class="flex items-center mb-3">
                                <input type="checkbox" id="categorizarFatura" class="mr-2">
                                <label for="categorizarFatura" class="font-medium text-gray-800">Categorizar fatura</label>
                            </div>
                            <div id="categoryOptions" class="ml-6 space-y-2" style="display: none;">
                                <select id="categoriaContabil" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                    <option value="">Selecionar categoria contábil...</option>
                                    <option value="fornecimentos-servicos-externos">Fornecimentos e Serviços Externos</option>
                                    <option value="mercadorias">Mercadorias</option>
                                    <option value="materias-primas">Matérias-primas</option>
                                    <option value="equipamentos">Equipamentos</option>
                                    <option value="servicos-profissionais">Serviços Profissionais</option>
                                    <option value="marketing-publicidade">Marketing e Publicidade</option>
                                    <option value="viagens-deslocacoes">Viagens e Deslocações</option>
                                    <option value="comunicacoes">Comunicações</option>
                                    <option value="seguros">Seguros</option>
                                    <option value="outros">Outros</option>
                                </select>
                                <input type="text" id="tagsPersonalizadas" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" placeholder="Tags personalizadas (separadas por vírgula)">
                                <div class="bg-yellow-50 border border-yellow-200 rounded p-3 text-sm">
                                    <p class="font-medium text-yellow-800 mb-1">💡 Sugestão automática:</p>
                                    <p id="sugestaoCategoria" class="text-yellow-700">Categoria será sugerida com base no valor e fornecedor</p>
                                </div>
                            </div>
                        </div>

                        <!-- Accounts Payable -->
                        <div class="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                            <button class="accordion-header w-full px-4 py-3 text-left font-medium text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center justify-between" data-target="payable-section">
                                <div class="flex items-center">
                                    <span class="mr-2">📝</span> Contas a Pagar
                                </div>
                                <svg class="accordion-icon w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="payable-section" class="accordion-content p-4 border-t border-gray-200" style="display: none;">
                            <div class="flex items-center mb-3">
                                <input type="checkbox" id="contasPagar" class="mr-2">
                                <label for="contasPagar" class="font-medium text-gray-800">Lançar documento em contas a pagar</label>
                            </div>
                            <div id="payableOptions" class="ml-6 space-y-2" style="display: none;">
                                <input type="date" id="dataVencimento" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <label class="text-xs text-gray-600">Data de vencimento</label>
                            </div>
                        </div>

                        <!-- Payment Attachment -->
                        <div class="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                            <button class="accordion-header w-full px-4 py-3 text-left font-medium text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center justify-between" data-target="attachment-section">
                                <div class="flex items-center">
                                    <span class="mr-2">📎</span> Anexos de Pagamento
                                </div>
                                <svg class="accordion-icon w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="attachment-section" class="accordion-content p-4 border-t border-gray-200" style="display: none;">
                            <div class="flex items-center mb-3">
                                <input type="checkbox" id="anexarComprovativo" class="mr-2">
                                <label for="anexarComprovativo" class="font-medium text-gray-800">Anexar comprovativo após pagamento</label>
                            </div>
                            <div class="ml-6 text-xs text-gray-600">
                                Sistema irá solicitar anexo do comprovativo após confirmação do pagamento
                            </div>
                        </div>

                        <!-- Notifications -->
                        <div class="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                            <button class="accordion-header w-full px-4 py-3 text-left font-medium text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex items-center justify-between" data-target="notifications-section">
                                <div class="flex items-center">
                                    <span class="mr-2">🔔</span> Notificações
                                </div>
                                <svg class="accordion-icon w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="notifications-section" class="accordion-content p-4 border-t border-gray-200" style="display: none;">
                            <div class="flex items-center mb-3">
                                <input type="checkbox" id="criarAlerta" class="mr-2">
                                <label for="criarAlerta" class="font-medium text-gray-800">Criar alerta de vencimento/recibo</label>
                            </div>
                            <div id="alertOptions" class="ml-6 space-y-3" style="display: none;">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Alerta</label>
                                    <select id="tipoAlerta" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                        <option value="vencimento">Alerta de vencimento</option>
                                        <option value="reconciliacao">Alerta de reconciliação</option>
                                        <option value="pagamento">Alerta de pagamento</option>
                                        <option value="ambos">Todos os alertas</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Antecedência</label>
                                    <select id="antecedenciaAlerta" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                        <option value="1">1 dia antes</option>
                                        <option value="3">3 dias antes</option>
                                        <option value="7">7 dias antes</option>
                                        <option value="15">15 dias antes</option>
                                        <option value="30">30 dias antes</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Método de Notificação</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="alertEmail" class="mr-2" checked>
                                            <span class="text-sm">📧 Email</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="alertSMS" class="mr-2">
                                            <span class="text-sm">📱 SMS</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="alertPush" class="mr-2" checked>
                                            <span class="text-sm">🔔 Notificação Push</span>
                                        </label>
                                    </div>
                                </div>
                                <div id="alertPreview" class="bg-blue-50 border border-blue-200 rounded-md p-3 text-sm">
                                    <div class="font-medium text-blue-800 mb-1">Preview do Alerta:</div>
                                    <div id="alertPreviewText" class="text-blue-700"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-between items-center pt-6 border-t">
                    <button id="cancelProcessing" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">
                        Cancelar
                    </button>
                    <div class="flex gap-3">
                        <button id="saveAsDraft" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg">
                            💾 Salvar como Rascunho
                        </button>
                        <button id="processInvoice" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-semibold">
                            🚀 Processar Fatura
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stats Section -->
            <div id="stats-section" class="section-content" style="display: none;">
                <!-- Enhanced Compact Statistics Panel -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
                <!-- Statistics Header with Toggle -->
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white flex items-center gap-2">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Estatísticas do Scanner
                    </h3>
                    <button id="statsToggle" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors">
                        <svg class="w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                </div>

                <!-- Compact Stats Overview (Always Visible) -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 rounded-lg p-3 text-center">
                        <div id="scanCount" class="text-xl font-bold text-blue-600 dark:text-blue-400">0</div>
                        <div class="text-xs text-blue-700 dark:text-blue-300">QRs Lidos</div>
                    </div>
                    <div class="bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30 rounded-lg p-3 text-center">
                        <div id="successCount" class="text-xl font-bold text-green-600 dark:text-green-400">0</div>
                        <div class="text-xs text-green-700 dark:text-green-300">Sucessos</div>
                    </div>
                    <div class="bg-gradient-to-r from-red-50 to-red-100 dark:from-red-900/30 dark:to-red-800/30 rounded-lg p-3 text-center">
                        <div id="errorCount" class="text-xl font-bold text-red-600 dark:text-red-400">0</div>
                        <div class="text-xs text-red-700 dark:text-red-300">Erros</div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/30 dark:to-purple-800/30 rounded-lg p-3 text-center">
                        <div id="avgTime" class="text-xl font-bold text-purple-600 dark:text-purple-400">0ms</div>
                        <div class="text-xs text-purple-700 dark:text-purple-300">Tempo Médio</div>
                    </div>
                </div>

                <!-- Detailed Statistics (Collapsible) -->
                <div id="detailedStats" class="space-y-4">
                    <!-- Session Summary -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                        <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Resumo da Sessão
                        </h4>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Taxa de Sucesso:</span>
                                <span id="successRate" class="font-semibold text-green-600 dark:text-green-400 ml-1">100%</span>
                            </div>
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Última Fatura:</span>
                                <span id="lastInvoiceTime" class="font-semibold text-blue-600 dark:text-blue-400 ml-1">--:--</span>
                            </div>
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Sessão Iniciada:</span>
                                <span id="sessionStart" class="font-semibold text-gray-700 dark:text-gray-300 ml-1">--:--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                        <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            Performance
                        </h4>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Tempo Mínimo:</span>
                                <span id="minTime" class="font-semibold text-green-600 dark:text-green-400 ml-1">--</span>
                            </div>
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Tempo Máximo:</span>
                                <span id="maxTime" class="font-semibold text-red-600 dark:text-red-400 ml-1">--</span>
                            </div>
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">QRs/min:</span>
                                <span id="qrPerMinute" class="font-semibold text-blue-600 dark:text-blue-400 ml-1">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="flex gap-2 pt-2">
                        <button id="resetStats" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition-colors">
                            🔄 Reset
                        </button>
                        <button id="exportStats" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-colors">
                            📊 Exportar
                        </button>
                        <button id="shareStats" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm transition-colors">
                            📤 Compartilhar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Enhanced Debug Log with Modern Design -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Debug Log & System Analysis
                    </h2>
                    <div class="flex gap-2">
                        <button id="clearLog" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors duration-200 flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                            Limpar
                        </button>
                        <button id="exportLog" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm transition-colors duration-200 flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Exportar
                        </button>
                        <button id="generateReport" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm transition-colors duration-200 flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Relatório
                        </button>
                    </div>
                </div>
                
                <!-- Enhanced Log Filters with Modern Design -->
                <div class="mb-4 flex flex-wrap gap-2">
                    <button class="log-filter active bg-gradient-to-r from-gray-700 to-gray-800 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-md transition-all duration-200 hover:shadow-lg" data-level="all">
                        <span class="flex items-center gap-1">
                            <div class="w-2 h-2 bg-white rounded-full"></div>
                            Todos
                        </span>
                    </button>
                    <button class="log-filter bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200" data-level="info">
                        <span class="flex items-center gap-1">
                            <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                            Info
                        </span>
                    </button>
                    <button class="log-filter bg-green-50 hover:bg-green-100 text-green-700 border border-green-200 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200" data-level="success">
                        <span class="flex items-center gap-1">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            Sucesso
                        </span>
                    </button>
                    <button class="log-filter bg-yellow-50 hover:bg-yellow-100 text-yellow-700 border border-yellow-200 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200" data-level="warning">
                        <span class="flex items-center gap-1">
                            <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                            Avisos
                        </span>
                    </button>
                    <button class="log-filter bg-red-50 hover:bg-red-100 text-red-700 border border-red-200 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200" data-level="error">
                        <span class="flex items-center gap-1">
                            <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                            Erros
                        </span>
                    </button>
                    <button class="log-filter bg-purple-50 hover:bg-purple-100 text-purple-700 border border-purple-200 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200" data-level="debug">
                        <span class="flex items-center gap-1">
                            <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                            Debug
                        </span>
                    </button>
                </div>
                
                <!-- Enhanced Log Display with Color-Coded Messages -->
                <div id="debugLog" class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 h-80 overflow-y-auto font-mono text-sm border border-gray-200 shadow-inner">
                    <div class="log-entry info-entry border-l-4 border-blue-400 bg-blue-50 p-3 mb-2 rounded-r-lg" data-level="info" data-timestamp="2024-01-01T00:00:00.000Z">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="timestamp text-gray-500 text-xs">[00:00:00.000]</span>
                            <span class="level bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-semibold">INFO</span>
                        </div>
                        <div class="message text-gray-800">Debug log iniciado - QR Code Reader Service v2.0</div>
                        <div class="context text-xs text-gray-600 mt-1" data-context='{"version":"2.0","browser":"Chrome","userAgent":"Mozilla/5.0"}'>Sistema: Chrome v2.0</div>
                    </div>
                    <div class="log-entry success-entry border-l-4 border-green-400 bg-green-50 p-3 mb-2 rounded-r-lg" data-level="success" data-timestamp="2024-01-01T00:00:00.100Z">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="timestamp text-gray-500 text-xs">[00:00:00.100]</span>
                            <span class="level bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-semibold">SUCCESS</span>
                        </div>
                        <div class="message text-gray-800">Sistema pronto para processar imagens</div>
                        <div class="context text-xs text-gray-600 mt-1" data-context='{"capabilities":["camera","qr","processing"]}'>Recursos: câmera, QR, processamento</div>
                    </div>
                </div>
                
                <!-- Enhanced System Status -->
                <div class="mt-4 grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                        <span class="text-sm text-green-600 font-medium">Status do Sistema</span>
                        <div id="systemStatus" class="text-green-700 font-bold">✓ Online</div>
                        <div class="text-xs text-green-600 mt-1" id="uptime">Uptime: 00:00:00</div>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                        <span class="text-sm text-blue-600 font-medium">Última Operação</span>
                        <div id="lastOperation" class="text-blue-700 font-bold">Aguardando...</div>
                        <div class="text-xs text-blue-600 mt-1" id="lastOperationTime">--:--:--</div>
                    </div>
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                        <span class="text-sm text-purple-600 font-medium">Performance</span>
                        <div id="performanceMetrics" class="text-purple-700 font-bold">CPU: 0% | RAM: 0MB</div>
                        <div class="text-xs text-purple-600 mt-1" id="processingTime">Tempo médio: 0ms</div>
                    </div>
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-3">
                        <span class="text-sm text-orange-600 font-medium">Estatísticas</span>
                        <div id="sessionStats" class="text-orange-700 font-bold">QRs: 0 | Erros: 0</div>
                        <div class="text-xs text-orange-600 mt-1" id="successRate">Taxa sucesso: 100%</div>
                    </div>
                </div>

                <!-- Technical Details for LLM Analysis -->
                <div class="mt-4">
                    <details class="bg-gray-100 rounded-lg">
                        <summary class="p-3 cursor-pointer font-medium text-gray-700 hover:bg-gray-200 rounded-lg">
                            🔧 Detalhes Técnicos para Análise (LLM/Ferramentas)
                        </summary>
                        <div class="p-4 border-t bg-white">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <h4 class="font-semibold text-gray-800 mb-2">Environment Info</h4>
                                    <pre id="envInfo" class="bg-gray-50 p-2 rounded text-xs overflow-auto">
{
  "userAgent": "Loading...",
  "platform": "Loading...",
  "language": "Loading...",
  "cookieEnabled": false,
  "onLine": true,
  "hardwareConcurrency": 0,
  "deviceMemory": 0
}
                                    </pre>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-800 mb-2">Camera Capabilities</h4>
                                    <pre id="cameraInfo" class="bg-gray-50 p-2 rounded text-xs overflow-auto">
{
  "available": false,
  "permissions": "unknown",
  "constraints": {},
  "activeStream": null,
  "supportedFormats": []
}
                                    </pre>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-800 mb-2">QR Processing Stats</h4>
                                    <pre id="qrStats" class="bg-gray-50 p-2 rounded text-xs overflow-auto">
{
  "totalScanned": 0,
  "successfulReads": 0,
  "failedReads": 0,
  "averageProcessingTime": 0,
  "lastQRData": null,
  "errorPatterns": []
}
                                    </pre>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-800 mb-2">Error Analysis</h4>
                                    <pre id="errorAnalysis" class="bg-gray-50 p-2 rounded text-xs overflow-auto">
{
  "recentErrors": [],
  "errorFrequency": {},
  "criticalIssues": [],
  "suggestedFixes": []
}
                                    </pre>
                                </div>
                            </div>
                        </div>
                    </details>
                </div>
            </div>
            </div>

            <!-- Settings Section -->
            <div id="settings-section" class="section-content" style="display: none;">
                <!-- Settings Panel -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white flex items-center gap-2">
                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            Configurações do Sistema
                        </h3>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Scanner Settings -->
                        <div class="space-y-4">
                            <h4 class="text-md font-semibold text-gray-700 dark:text-gray-300">Scanner</h4>
                            
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <label class="text-sm text-gray-600 dark:text-gray-400">Auto-scan contínuo</label>
                                    <input type="checkbox" id="autoScanSetting" class="toggle-checkbox" checked>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <label class="text-sm text-gray-600 dark:text-gray-400">Som de confirmação</label>
                                    <input type="checkbox" id="soundSetting" class="toggle-checkbox" checked>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <label class="text-sm text-gray-600 dark:text-gray-400">Vibração (mobile)</label>
                                    <input type="checkbox" id="vibrationSetting" class="toggle-checkbox">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Processing Settings -->
                        <div class="space-y-4">
                            <h4 class="text-md font-semibold text-gray-700 dark:text-gray-300">Processamento</h4>
                            
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <label class="text-sm text-gray-600 dark:text-gray-400">Processamento automático</label>
                                    <input type="checkbox" id="autoProcessSetting" class="toggle-checkbox" checked>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <label class="text-sm text-gray-600 dark:text-gray-400">Validação rigorosa</label>
                                    <input type="checkbox" id="strictValidationSetting" class="toggle-checkbox">
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <label class="text-sm text-gray-600 dark:text-gray-400">Backup automático</label>
                                    <input type="checkbox" id="autoBackupSetting" class="toggle-checkbox" checked>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <button id="resetSettings" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">
                            Restaurar Padrões
                        </button>
                        <button id="saveSettings" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                            Salvar Configurações
                        </button>
                    </div>
                </div>
            </div>
        </div>
        </div> <!-- Close main content container -->
    </div> <!-- Close lg:ml-64 container -->

    <!-- Help/Tutorial Modal -->
    <div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center">
                    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg p-2 mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Tutorial & Ajuda</h2>
                        <p class="text-gray-600 dark:text-gray-400">Guia completo do Leitor de Faturas</p>
                    </div>
                </div>
                <button id="closeHelpModal" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                    <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Content -->
            <div class="p-6">
                <!-- Tutorial Tabs -->
                <div class="flex space-x-1 mb-6 bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                    <button class="tutorial-tab flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors active" data-tab="getting-started">
                        🚀 Começar
                    </button>
                    <button class="tutorial-tab flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors" data-tab="scanner-guide">
                        📱 Scanner
                    </button>
                    <button class="tutorial-tab flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors" data-tab="features">
                        ⚙️ Funcionalidades
                    </button>
                    <button class="tutorial-tab flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors" data-tab="troubleshooting">
                        🔧 Problemas
                    </button>
                </div>

                <!-- Tab Content -->
                <div id="getting-started" class="tutorial-content">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">🚀 Primeiros Passos</h3>
                    <div class="space-y-6">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 dark:text-blue-300 mb-2">📋 O que é o Leitor de Faturas?</h4>
                            <p class="text-gray-700 dark:text-gray-300">Sistema inteligente para digitalização e processamento automático de faturas portuguesas através de QR codes, com integração contabilística completa.</p>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                <div class="flex items-center mb-3">
                                    <div class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">1</div>
                                    <h4 class="font-semibold text-gray-800 dark:text-white">Preparação</h4>
                                </div>
                                <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                    <li>• Tenha as faturas com QR code em mãos</li>
                                    <li>• Certifique-se de ter boa iluminação</li>
                                    <li>• Permita acesso à câmera quando solicitado</li>
                                </ul>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                <div class="flex items-center mb-3">
                                    <div class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">2</div>
                                    <h4 class="font-semibold text-gray-800 dark:text-white">Digitalização</h4>
                                </div>
                                <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                    <li>• Clique em "Iniciar Câmera"</li>
                                    <li>• Aponte para o QR code da fatura</li>
                                    <li>• Aguarde o processamento automático</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="scanner-guide" class="tutorial-content hidden">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">📱 Guia do Scanner</h3>
                    <div class="space-y-6">
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg p-4">
                            <h4 class="font-semibold text-green-800 dark:text-green-300 mb-2">📸 Dicas para Melhor Digitalização</h4>
                            <div class="grid md:grid-cols-2 gap-4 mt-4">
                                <div>
                                    <h5 class="font-medium text-green-700 dark:text-green-400 mb-2">✅ Faça Assim:</h5>
                                    <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-1">
                                        <li>• Mantenha a fatura plana e bem iluminada</li>
                                        <li>• Posicione o QR code no centro da tela</li>
                                        <li>• Mantenha distância de 10-20cm</li>
                                        <li>• Aguarde o foco automático</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="font-medium text-red-700 dark:text-red-400 mb-2">❌ Evite:</h5>
                                    <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-1">
                                        <li>• QR codes danificados ou sujos</li>
                                        <li>• Reflexos de luz direta</li>
                                        <li>• Movimentos bruscos da câmera</li>
                                        <li>• Faturas dobradas ou amassadas</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                            <h4 class="font-semibold text-gray-800 dark:text-white mb-3">🔄 Processo de Digitalização</h4>
                            <div class="space-y-3">
                                <div class="flex items-center">
                                    <div class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3">1</div>
                                    <span class="text-gray-700 dark:text-gray-300">Detecção automática do QR code</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3">2</div>
                                    <span class="text-gray-700 dark:text-gray-300">Extração dos dados da fatura</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3">3</div>
                                    <span class="text-gray-700 dark:text-gray-300">Validação e processamento</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3">4</div>
                                    <span class="text-gray-700 dark:text-gray-300">Integração contabilística automática</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="features" class="tutorial-content hidden">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">⚙️ Funcionalidades Avançadas</h3>
                    <div class="space-y-6">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                <h4 class="font-semibold text-gray-800 dark:text-white mb-3 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    Estatísticas
                                </h4>
                                <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                    <li>• Contadores de QRs processados</li>
                                    <li>• Taxa de sucesso em tempo real</li>
                                    <li>• Métricas de performance</li>
                                    <li>• Exportação de relatórios</li>
                                </ul>
                            </div>

                            <div class="bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                <h4 class="font-semibold text-gray-800 dark:text-white mb-3 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                                    </svg>
                                    Modo Escuro
                                </h4>
                                <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                    <li>• Interface adaptável</li>
                                    <li>• Reduz fadiga visual</li>
                                    <li>• Economia de bateria</li>
                                    <li>• Preferência salva automaticamente</li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg p-4">
                            <h4 class="font-semibold text-purple-800 dark:text-purple-300 mb-3">🔧 Configurações Avançadas</h4>
                            <div class="grid md:grid-cols-3 gap-4">
                                <div>
                                    <h5 class="font-medium text-gray-800 dark:text-white mb-2">Integração Bancária</h5>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Configuração automática de contas e categorias contabilísticas</p>
                                </div>
                                <div>
                                    <h5 class="font-medium text-gray-800 dark:text-white mb-2">Controlo de IVA</h5>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Validação automática de taxas e cálculos fiscais</p>
                                </div>
                                <div>
                                    <h5 class="font-medium text-gray-800 dark:text-white mb-2">Notificações</h5>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Alertas personalizados para processamento</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="troubleshooting" class="tutorial-content hidden">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">🔧 Resolução de Problemas</h3>
                    <div class="space-y-6">
                        <div class="bg-gradient-to-r from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 rounded-lg p-4">
                            <h4 class="font-semibold text-red-800 dark:text-red-300 mb-3">⚠️ Problemas Comuns</h4>
                            <div class="space-y-4">
                                <div class="bg-white dark:bg-gray-700 rounded-lg p-3 border-l-4 border-red-500">
                                    <h5 class="font-medium text-gray-800 dark:text-white mb-1">Câmera não funciona</h5>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">A câmera não inicia ou não consegue aceder</p>
                                    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                        <li>• Verifique as permissões do navegador</li>
                                        <li>• Certifique-se de que não há outras aplicações a usar a câmera</li>
                                        <li>• Recarregue a página e tente novamente</li>
                                        <li>• Use HTTPS (necessário para acesso à câmera)</li>
                                    </ul>
                                </div>

                                <div class="bg-white dark:bg-gray-700 rounded-lg p-3 border-l-4 border-yellow-500">
                                    <h5 class="font-medium text-gray-800 dark:text-white mb-1">QR code não é reconhecido</h5>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">O scanner não consegue ler o código</p>
                                    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                        <li>• Melhore a iluminação do ambiente</li>
                                        <li>• Limpe a lente da câmera</li>
                                        <li>• Aproxime ou afaste a fatura da câmera</li>
                                        <li>• Verifique se o QR code não está danificado</li>
                                    </ul>
                                </div>

                                <div class="bg-white dark:bg-gray-700 rounded-lg p-3 border-l-4 border-blue-500">
                                    <h5 class="font-medium text-gray-800 dark:text-white mb-1">Processamento lento</h5>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">O sistema demora muito a processar</p>
                                    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                        <li>• Verifique a ligação à internet</li>
                                        <li>• Feche outras abas do navegador</li>
                                        <li>• Limpe o cache do navegador</li>
                                        <li>• Reinicie o navegador se necessário</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-lg p-4">
                            <h4 class="font-semibold text-green-800 dark:text-green-300 mb-3">💡 Dicas de Performance</h4>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <h5 class="font-medium text-gray-800 dark:text-white mb-2">Otimização</h5>
                                    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                        <li>• Use navegadores modernos (Chrome, Firefox, Safari)</li>
                                        <li>• Mantenha o navegador atualizado</li>
                                        <li>• Feche aplicações desnecessárias</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="font-medium text-gray-800 dark:text-white mb-2">Melhores Práticas</h5>
                                    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                        <li>• Processe faturas em lotes pequenos</li>
                                        <li>• Verifique regularmente as estatísticas</li>
                                        <li>• Faça backup dos dados processados</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-between items-center mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex space-x-3">
                        <button id="startTutorialDemo" class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-2 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1.01M15 10h1.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Demo Interativa
                        </button>
                        <button id="exportHelpGuide" class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-6 py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Exportar Guia
                        </button>
                    </div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        Versão 2.1.0 • Grupo AreLuna
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Processing Modal -->
    <div id="invoiceModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-6xl w-full max-h-[95vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center">
                    <div class="bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg p-2 mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Processamento de Fatura</h2>
                        <p class="text-gray-600 dark:text-gray-400">Dados da fatura e integrações contabilísticas</p>
                    </div>
                </div>
                <button id="closeInvoiceModal" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                    <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Content -->
            <div class="p-6">
                <!-- Invoice Data Section -->
                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Dados da Fatura
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">NIF do Fornecedor</label>
                            <input type="text" id="supplierNIF" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" placeholder="123456789">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nome do Fornecedor</label>
                            <input type="text" id="supplierName" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" placeholder="Nome da empresa">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Número da Fatura</label>
                            <input type="text" id="invoiceNumber" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" placeholder="FT 2024/001">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data da Fatura</label>
                            <input type="date" id="invoiceDate" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Valor sem IVA (€)</label>
                            <input type="number" id="netAmount" step="0.01" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" placeholder="100.00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Valor do IVA (€)</label>
                            <input type="number" id="vatAmount" step="0.01" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" placeholder="23.00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Valor Total (€)</label>
                            <input type="number" id="totalAmount" step="0.01" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-600" placeholder="123.00" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Taxa de IVA (%)</label>
                            <select id="vatRate" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                <option value="23">23% - Taxa Normal</option>
                                <option value="13">13% - Taxa Intermédia</option>
                                <option value="6">6% - Taxa Reduzida</option>
                                <option value="0">0% - Isento</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data de Vencimento</label>
                            <input type="date" id="dueDate" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                        </div>
                    </div>
                </div>

                <!-- Accounting Integration Section -->
                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                        </svg>
                        Integração Contabilística
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Categoria Contabilística</label>
                            <select id="accountingCategory" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                <option value="">Selecionar categoria...</option>
                                <option value="62">62 - Fornecimentos e Serviços Externos</option>
                                <option value="621">621 - Subcontratos</option>
                                <option value="622">622 - Serviços Especializados</option>
                                <option value="623">623 - Publicidade e Propaganda</option>
                                <option value="624">624 - Vigilância e Segurança</option>
                                <option value="625">625 - Conservação e Reparação</option>
                                <option value="626">626 - Honorários</option>
                                <option value="627">627 - Trabalhos Especializados</option>
                                <option value="628">628 - Outros Fornecimentos</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Centro de Custo</label>
                            <select id="costCenter" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                <option value="">Selecionar centro...</option>
                                <option value="ADM">Administração</option>
                                <option value="VEN">Vendas</option>
                                <option value="MKT">Marketing</option>
                                <option value="TI">Tecnologia</option>
                                <option value="RH">Recursos Humanos</option>
                                <option value="FIN">Financeiro</option>
                                <option value="OPE">Operações</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Regime de IVA</label>
                            <select id="vatRegime" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                <option value="normal">Normal</option>
                                <option value="isento">Isento</option>
                                <option value="nao_sujeito">Não Sujeito</option>
                                <option value="regime_especial">Regime Especial</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Conta de Fornecedor</label>
                            <input type="text" id="supplierAccount" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" placeholder="221001">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Conta de IVA</label>
                            <input type="text" id="vatAccount" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" placeholder="243101">
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="ivaDeductible" class="mr-2 rounded focus:ring-2 focus:ring-blue-500">
                            <label for="ivaDeductible" class="text-sm font-medium text-gray-700 dark:text-gray-300">IVA Dedutível</label>
                        </div>
                    </div>
                </div>

                <!-- Banking Integration Section -->
                <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                        </svg>
                        Integração Bancária
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Banco</label>
                            <select id="bankName" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white">
                                <option value="">Selecionar banco...</option>
                                <option value="CGD">Caixa Geral de Depósitos</option>
                                <option value="BCP">Millennium BCP</option>
                                <option value="BES">Novo Banco</option>
                                <option value="BPI">Banco BPI</option>
                                <option value="SANTANDER">Santander Totta</option>
                                <option value="BBVA">BBVA</option>
                                <option value="CREDITO_AGRICOLA">Crédito Agrícola</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Conta Bancária</label>
                            <input type="text" id="bankAccount" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white" placeholder="NIB ou IBAN">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Método de Pagamento</label>
                            <select id="paymentMethod" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white">
                                <option value="transferencia">Transferência Bancária</option>
                                <option value="debito_direto">Débito Direto</option>
                                <option value="cheque">Cheque</option>
                                <option value="dinheiro">Dinheiro</option>
                                <option value="multibanco">Multibanco</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Referência de Pagamento</label>
                            <input type="text" id="paymentReference" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white" placeholder="Gerada automaticamente" readonly>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="automaticPayment" class="mr-2 rounded focus:ring-2 focus:ring-green-500">
                            <label for="automaticPayment" class="text-sm font-medium text-gray-700 dark:text-gray-300">Pagamento Automático</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="paymentAlert" class="mr-2 rounded focus:ring-2 focus:ring-green-500">
                            <label for="paymentAlert" class="text-sm font-medium text-gray-700 dark:text-gray-300">Alerta de Vencimento</label>
                        </div>
                    </div>
                </div>

                <!-- Export and Compliance Section -->
                <div class="bg-purple-50 dark:bg-purple-900/20 rounded-xl p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Exportação e Conformidade
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button id="exportSAFT" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Exportar SAF-T
                        </button>
                        <button id="validateAT" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Validar AT
                        </button>
                        <button id="exportExcel" class="bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path>
                            </svg>
                            Backup Excel
                        </button>
                    </div>
                </div>

                <!-- Processing Progress -->
                <div id="processingProgress" class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-6" style="display: none;">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Processamento em Curso</h3>
                    
                    <!-- Progress Bar -->
                    <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2 mb-4">
                        <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <div class="text-center text-sm text-gray-600 dark:text-gray-400 mb-4">
                        <span id="progressPercentage">0%</span> concluído
                    </div>
                    
                    <!-- Processing Steps -->
                    <div class="space-y-3">
                        <div id="step1" class="flex items-center text-gray-600 dark:text-gray-400">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3 flex items-center justify-center">
                                <div class="w-2 h-2 bg-gray-300 rounded-full"></div>
                            </div>
                            <span>Validando dados da fatura...</span>
                        </div>
                        <div id="step2" class="flex items-center text-gray-600 dark:text-gray-400">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3 flex items-center justify-center">
                                <div class="w-2 h-2 bg-gray-300 rounded-full"></div>
                            </div>
                            <span>Processando integração contabilística...</span>
                        </div>
                        <div id="step3" class="flex items-center text-gray-600 dark:text-gray-400">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3 flex items-center justify-center">
                                <div class="w-2 h-2 bg-gray-300 rounded-full"></div>
                            </div>
                            <span>Configurando integração bancária...</span>
                        </div>
                        <div id="step4" class="flex items-center text-gray-600 dark:text-gray-400">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3 flex items-center justify-center">
                                <div class="w-2 h-2 bg-gray-300 rounded-full"></div>
                            </div>
                            <span>Finalizando processamento...</span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-between items-center pt-6 border-t border-gray-200 dark:border-gray-700">
                    <button id="cancelProcessing" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors">
                        Cancelar
                    </button>
                    <div class="flex gap-3">
                        <button id="saveAsDraft" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg transition-colors">
                            💾 Salvar como Rascunho
                        </button>
                        <button id="processInvoice" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors font-semibold">
                            🚀 Processar Fatura
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JSQRScanner JavaScript -->
    <!-- JavaScript Modules -->
    <script src="/js/debug-console.js"></script>
    <script src="/js/api-client.js"></script>
    <script src="/js/qr-scanner.js"></script>
    <script src="/js/app.js"></script>
    
    <!-- Debug Info Banner -->
    <div style="position: fixed; bottom: 10px; right: 10px; background: rgba(0,255,0,0.9); color: black; padding: 10px 15px; border-radius: 5px; font-size: 12px; font-weight: bold; z-index: 9999; cursor: pointer;" onclick="window.debug.toggle()">
        🐛 DEBUG CONSOLE<br>
        <small style="font-weight: normal;">Ctrl+Shift+D</small>
    </div>
</body>
</html>
